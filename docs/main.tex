\documentclass[12pt,a4paper]{article}
\usepackage{listings}
\usepackage{geometry}
\usepackage{setspace}
\usepackage{fancyhdr}
\usepackage{xcolor}
\usepackage{polyglossia}
\usepackage{hyperref}

\setdefaultlanguage{greek}
\setotherlanguage{english}
\setmainfont{Times New Roman}
\newfontfamily\greekfont{Times New Roman}
\newfontfamily\englishfont{Times New Roman}

\setlength{\headheight}{15pt}

\geometry{margin=2.5cm}
\doublespacing
\pagestyle{fancy}
\fancyhf{}
\fancyhead[R]{\thepage}
\fancyhead[L]{Έξυπνο Συμβόλαιο Διαχείρισης Στοιχείων Κατοικιδίων}


\begin{document}

\include{solidity_listings}

\begin{titlepage}
    \centering
    \vspace*{2cm}
    
    {\huge\textbf{Έξυπνο Συμβόλαιο Διαχείρισης Στοιχείων Κατοικιδίων}}\\
    \vspace{2cm}
    {\large Προγραμματιστική Εργασία Solidity (2025)}
    \vspace{3cm}
    
    {\large\ \textbf{Μάθημα:} Τεχνολογίες Blockchain \& Εφαρμογές}\\
    {\large\ \textbf{Καθηγήτρια:} Δρ. Αριστέα Κοντογιάννη}\\
    \vspace{2cm}
    
    {\large Γιώργος Νικολαΐδης (π21115)}\\
\end{titlepage}

% - Η εργασια εμπεριέχει ένα αρχείο κώδικα Solidity 
% - Στο κώδικα ορίζεται ένα εξυπνο συμβόλαιο "Pets"
% - Το "Pets" contract καθορίζει 5 μεθόδους, μια για κάθε λειτουργία της εκφώνησης
\section{Εισαγωγή}
Η παρούσα εργασία εμπεριέχει ένα αρχείο κώδικο Solidity που ορίζεται ένα έξυπνο συμβόλαιο ονόματι "\textbf{Pets}". Το συμβόλαιο καθορίζει πέντε μεθόδους (functions), η κάθε μέθοδος υλοποιεί μια λειτουργία που ορίζει η εκφώνηση. 

Στις δύο ενότητες που ακολουθούν, θα αναλυθεί περαιτέρω ο κώδικας και θα φανεί σε πράξη η λειτουργία του έξυπνου συμβόλαιου.

\newpage

\section{Ανάλυση Κώδικα}

\subsection{Ο Κώδικας}
\lstinputlisting[language=Solidity]{../contracts/Pets.sol}

\subsection{Τα Μέρη του Συμβολαίου}
Το συμβόλαιο εσωτερικά είναι χωρισμένο σε διάφορα μέρη.

\subsubsection{Ορισμός Δομών Δεδομένων}
Στο συμβόλαιο γίνεται η χρήση ειδικών δομών δεδομένων (struct) για να επιτευχθεί η ορθή και ξεκάθαρη μοντελοποίηση του προβλήματος.

\begin{itemize}
    \item \textbf{Pet}: Μοντελοποιεί τις ιδιότητες ενός κατοικιδίου, όπως ορίζεται στην εκφώνηση της εργασίας. Δεν έχει πεδίο για τον μοναδικό κωδικό chip (Chip ID), η ταυτοποίηση με τον κωδικό γίνεται σε σημείο που θα δούμε αμέσως μέτα. Αξίζει να σημειωθεί η παρουσία των ιδιοτήτων \textbf{createdAt} και \textbf{modifiedAt}, η οποίες υπάρχουν για λόγους auditing - να μπορεί οποιοσδήποτε να δεί πότε δημιουργήθηκε/ενημερώθηκε ένα κατοικίδιο.
    
    \item \textbf{PetStatus}: Παρέχει πληροφορίες για την κατάσταση του κατοικιδίου - αν είναι ενεργό στο σύστημα και μια αιτιόλογηση για αν δεν είναι.
\end{itemize}

\subsubsection{Μεταβλητές Κατάστασης (State Variables)}
Για την αποθήκη των δεδομένων των κατοικιδίων χρησιμοποιούνται δύο state variables:

\begin{itemize}
    \item \textbf{pets}: Είναι ένας πίνακας κατακερματισμού (hash table) με κλειδί το μοναδικό κωδικό chip (Chip ID) και τιμή ένα κατοικίδιο. Αποτελεί τη μεταβλητή στην οποιά αποθηκεύονται όλα τα δεδομένα των κατοικιδίων που εισάγωγονται/ενημερώνονται.\
    \item \textbf{existingPets}: Βοηθητικός πίνακας κατακερματισμού για να αναγνωρίζει το συμβόλαιο αν κάποιο κατοικίδιο είναι καταχωριμένο στο δεδομένα του. Η ανάγκη για αυτή τη μεταβλητή υπάρχει λόγω της ειδικής υλοποιήσης του πίνακα κατακερματισμού από τη Solidity. Στο  \href{https://docs.soliditylang.org/en/v0.8.30/types.html#mapping-types}{documentation της γλώσσας}, αναγράφεται ότι: \begin{quote}
        You can think of mappings as hash tables, which are virtually initialised such that every possible key exists and is mapped to a value whose byte-representation is all zeros, a type’s default value... Because of this, mappings do not have a length or a concept of a key or value being set, and therefore cannot be erased without extra information regarding the assigned keys
    \end{quote}
\end{itemize}

\subsubsection{Function Modifiers}
Οι function modifiers μπορούν να χαρακτηριστούν ως "Decorators" (από το Decorator design pattern), επείδη επεκτήνουν την λειτουργία των μεθόδων που αναθέτονται χώρις να είναι μέρος της υλοποιήσης τους.

Στην περίπτωση της παρούσας εργασίας, χρησιμοποιούνται για την επικύρωση των εισόδων που δέχονται οι μέθοδοι. Με σκοπό την πρόωρη επιστροφή σε περίπτωση που υπάρχει σφάλμα στις εισόδους. Ορίζουμε δύο modifiers:
\begin{itemize}
    \item \textbf{petExists}: Ελέγχει αν ο μοναδικός κωδικός chip είναι καταχωριμένος στο σύστημα. Αν δεν υπάρχει, επιστρέφει πρόωρα ένα μήνυμα επικύρωσης στον caller.
    \item \textbf{petDoesNotExist}: Ελέγχει αν ο μοναδικός κωδικός chip είναι καταχωριμένος στο σύστημα. Αν υπάρχει, επιστρέφει πρόωρα ένα μήνυμα επικύρωσης στον caller.
\end{itemize}

\end{document}